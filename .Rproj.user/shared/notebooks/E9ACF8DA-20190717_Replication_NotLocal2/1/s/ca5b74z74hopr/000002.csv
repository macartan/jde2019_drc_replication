"0","df = vill"
"0","dv = ""da109_not_verifiable"""
"0",""
"0","cols <- c(""TUUNGANE"", ""WEIGHT"", ""LOTT_BIN"","
"0","          ""IDV"", ""IDV_CDCCODE"", ""IDS_CDCCODE"","
"0","          ""CHIEF"", ""qr026i_fund_misuse"", ""res"","
"0","          ""da109_not_verifiable"")"
"0","dat <- df[, intersect(names(df), cols)]"
"0","dat <- dat %>% arrange(LOTT_BIN)"
"0",""
"0","#residuals of village-level obs in control"
"0","dat0 <- dat[dat$TUUNGANE == 0 & !is.na(dat[[dv]]),]"
"0","dat0$dv <- dat0[[dv]]"
"0","m <- lm(dv ~ TUUNGANE + as.factor(LOTT_BIN), data = dat0, weights = dat0$WEIGHT)"
"0","dat0$res <- m$residuals"
"0",""
"0","# Declare Tuungane Design"
"0","design_tuungane <- function(ate){"
"0","  "
"0","  #duplicate control data (note 1/3 outcomes missing for ""da109_not_verifiable"")"
"0","  dat01 <- dat0"
"0","  dat01$IDV <- paste0(""dup"", dat0$IDV)"
"0","  dat <- rbind(dat01,dat0)"
"0","  "
"0","  U <- declare_population(data = dat)"
"0","  "
"0","  Y <- declare_potential_outcomes("
"0","    Y_Z_0 = res,"
"0","    Y_Z_1 = ate + res"
"0","  )"
"0","  "
"0","  per_block <- as.data.frame(table(dat$LOTT_BIN))$Freq / 2"
"0","  "
"0","  Z <- declare_assignment(blocks = LOTT_BIN, block_m = per_block)"
"0","  "
"0","  R <- declare_reveal(Y, Z)"
"0","  "
"0","  Q <- declare_estimand(ATE = mean(Y_Z_1 - Y_Z_0, na.rm = TRUE))"
"0","  "
"0","  "
"0","  B <- declare_estimator(Y ~ Z, #weights = ipw,"
"0","                         estimand = Q,"
"0","                         model = lm_robust,"
"0","                         label = ""tuungane_estimator"")"
"0","  "
"0","  "
"0","  design <- U + Y + Z + R  + Q + B #get_weights"
"0","  return(design)"
"0","}"
"0",""
