"0",""
"0","dvs_mech <- c(""PART_A1"", ""N_INTERV"", ""MALE_DOM"", ""MFI_SELECTION"", ""MFI_COMPOSITION"", ""MFI_MECHANISMS"", ""MFI_COMPLAINTS"", ""qr002CORRECT"", ""qi003_accept"", ""MFI_ACCOUNTING"")"
"0",""
"0","mechanisms <- list("
"0","  part  =  lm_robust(PART_A1   ~ TUUNGANE ,"
"0","                     data = vill, "
"0","                     fixed_effects = LOTT_BIN,"
"0","                     weights = VILL_WEIGHT),"
"0","  inter =  lm_robust(N_INTERV  ~ TUUNGANE ,"
"0","                     data = vill,"
"0","                     fixed_effects = LOTT_BIN,"
"0","                     weights = VILL_WEIGHT),"
"0","  male_d = lm_robust(MALE_DOM  ~ TUUNGANE,"
"0","                     data = vill,"
"0","                     fixed_effects = LOTT_BIN,"
"0","                     weights = VILL_WEIGHT),"
"0","  sel    = lm_robust(MFI_SELECTION ~ TUUNGANE ,"
"0","                     data = vill,"
"0","                     fixed_effects = LOTT_BIN,"
"0","                     weights = VILL_WEIGHT),"
"0","  compos = lm_robust(MFI_COMPOSITION ~ TUUNGANE,"
"0","                     fixed_effects = LOTT_BIN,"
"0","                     data = vill, "
"0","                     weights = VILL_WEIGHT),"
"0","  mech   = lm_robust(MFI_MECHANISMS  ~ TUUNGANE,"
"0","                     data  = vill,"
"0","                     fixed_effects = LOTT_BIN,"
"0","                     weights = VILL_WEIGHT),"
"0","  compl = lm_robust(MFI_COMPLAINTS ~ TUUNGANE + as.factor(LOTT_BIN),"
"0","                    data =  ind,"
"0","                    weights = VILL_WEIGHT,"
"0","                    clusters = IDS_CDCCODE),"
"0","  corr  = lm_robust(qr002CORRECT   ~ TUUNGANE + as.factor(LOTT_BIN),"
"0","                    data =  ind,"
"0","                    weights = VILL_WEIGHT,"
"0","                    clusters = IDS_CDCCODE),"
"0","  accep = lm_robust(qi003_accept  ~ TUUNGANE + as.factor(LOTT_BIN),"
"0","                    data =  ind, "
"0","                    weights = VILL_WEIGHT,"
"0","                    clusters = IDS_CDCCODE ),"
"0","  accoun = lm_robust(MFI_ACCOUNTING ~ TUUNGANE,"
"0","                     data  = vill,"
"0","                     fixed_effects = LOTT_BIN,"
"0","                     weights = VILL_WEIGHT)"
"0",")"
"0",""
"0","mechanisms_table <- mapply(function(x, name){ "
"0","  tidy = tidy(x); rownames(tidy) = tidy$term;"
"0","  round(c(Control  = tidy[""(Intercept)"", ""estimate""],"
"0","          Effect    = tidy[""TUUNGANE"", ""estimate""], "
"0","          std_error = tidy[""TUUNGANE"", ""std.error""], "
"0","          N         = x$N ),3)"
"0","  "
"0","}, mechanisms, names(mechanisms))"
"0",""
"0","add_cols <- mapply(function(d, dv){"
"0","  d <- d %>% arrange(LOTT_BIN)"
"0","  N_cluster <- ifelse(length(unique(d$IDV_CDCCODE[!is.na(d[[dv]])])) > 0,"
"0","                      length(unique(d$IDV_CDCCODE[!is.na(d[[dv]])])),"
"0","                      length(unique(d$IDS_CDCCODE[!is.na(d[[dv]])])))"
"0","  "
"0","  #block weights in the data"
"0","  d$dv <- d[[dv]][]"
"0","  #block average for control"
"0","  ave_ctrl_blocks <- d %>% "
"0","    subset(TUUNGANE == 0) %>%"
"0","    group_by(LOTT_BIN) %>%"
"0","    summarize(block_n = sum(!is.na(dv)),"
"0","              ave = mean(dv, na.rm = TRUE)) %>% ungroup() %>%"
"0","    mutate(block_w = block_n/nrow(.))"
"0","  #weighted average of block averages"
"0","  w_ave_ctrl_blocks <- weighted.mean(ave_ctrl_blocks$ave, ave_ctrl_blocks$block_w, na.rm = TRUE)"
"0","  #weighted sd of block averages"
"0","  w_sd_ctrl_blocks <- sd(d$dv, na.rm = TRUE)"
"0","  "
"0","  return(round(rbind(w_ave_ctrl_blocks, w_sd_ctrl_blocks, N_cluster), 3))"
"0","}, d = list(vill, vill, vill, vill, vill, vill, ind, ind, ind, vill), dv = dvs_mech) %>% t()"
"0",""
"0","mechanisms_table <- cbind(control.mean = add_cols[,1], control.sd = add_cols[,2], t(mechanisms_table)[,-1], N_cluster = add_cols[,3])"
"0",""
"0","kable(mechanisms_table)"
