
# Author: Alex Coppock
power_calculator_cluster <- function(mu_t, mu_c, sigma, ICC, alpha=0.05, n_clus_per_arm, N){
  n_per_clus <- N/(n_clus_per_arm*2)
  if(n_per_clus < 1){return(NA)}
  lowertail <- (abs(mu_t - mu_c) * sqrt((n_clus_per_arm - 1)*n_per_clus))/
    sqrt((2*(sigma^2) * (1 + (n_per_clus-1)*ICC)))
  uppertail <- -1*lowertail
  beta <- pnorm(lowertail - qnorm(1-alpha/2), lower.tail=TRUE) + 
    1 - pnorm(uppertail - qnorm(1-alpha/2), lower.tail=FALSE)
  return(beta)
}

